<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>研究成果 - 网络攻防对抗技术研究所</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/layui/css/layui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 主导航样式 */
        .nav-pills .nav-link {
            border-radius: 0;
            border-bottom: 3px solid transparent;
            color: #495057;
            font-weight: 500;
            transition: all 0.3s;
        }
        .nav-pills .nav-link.active {
            border-bottom-color: #1a237e;
            background: transparent;
            color: #1a237e;
            font-weight: bold;
        }

        /* 子导航样式 */
        .card-header-tabs .nav-link {
            padding: 0.5rem 1.25rem;
            color: #6c757d;
            border-bottom: 2px solid transparent;
        }
        .card-header-tabs .nav-link.active {
            color: #1a237e;
            border-bottom-color: #1a237e;
            background: rgba(26, 35, 126, 0.05);
        }

        /* 内容区样式 */
        .table-responsive {
            min-height: 400px;
            background: #fff;
            border-radius: 4px;
        }
        .export-btn {
            position: absolute;
            right: 15px;
            top: 8px;
        }
        .achievement-badge {
            font-size: 0.75em;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <!-- 面包屑导航 -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">首页</a></li>
            <li class="breadcrumb-item active">研究成果</li>
        </ol>
    </nav>

    <!-- 二级导航 -->
    <ul class="nav nav-pills mb-4" id="mainTabs">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="pill" href="#teachingTab">教学成果</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="pill" href="#researchTab">科研成果</a>
        </li>
    </ul>

    <div class="tab-content">
        <!-- 教学成果 -->
        <div class="tab-pane fade show active" id="teachingTab">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white position-relative">
                    <ul class="nav nav-tabs card-header-tabs" id="teachingTabs">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#teachingAchievement">成果</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#teachingPaper">论文</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#teachingTextbook">教材</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#teachingReform">教改</a>
                        </li>
                    </ul>
                    <button class="btn btn-sm btn-success export-btn" onclick="exportData('teaching')">
                        <i class="fas fa-file-export"></i> 导出Excel
                    </button>
                </div>

                <div class="card-body tab-content p-0">
                    <!-- 教学成果 -->
                    <div class="tab-pane fade show active" id="teachingAchievement">
                        <div class="table-responsive">
                            <table id="teachingAchievementTable" class="layui-table" lay-filter="teachingAchievement"></table>
                        </div>
                    </div>

                    <!-- 教学论文 -->
                    <div class="tab-pane fade" id="teachingPaper">
                        <div class="table-responsive">
                            <table id="teachingPaperTable" class="layui-table" lay-filter="teachingPaper"></table>
                        </div>
                    </div>

                    <!-- 教材 -->
                    <div class="tab-pane fade" id="teachingTextbook">
                        <div class="table-responsive">
                            <table id="textbookTable" class="layui-table" lay-filter="textbook"></table>
                        </div>
                    </div>

                    <!-- 教改项目 -->
                    <div class="tab-pane fade" id="teachingReform">
                        <div class="table-responsive">
                            <table id="teachingReformTable" class="layui-table" lay-filter="teachingReform"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 科研成果 -->
        <div class="tab-pane fade" id="researchTab">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white position-relative">
                    <ul class="nav nav-tabs card-header-tabs" id="researchTabs">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#researchAchievement">成果</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#researchPaper">论文</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#researchPatent">专利</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#researchCopyright">著作权</a>
                        </li>
                    </ul>
                    <button class="btn btn-sm btn-success export-btn" onclick="exportData('research')">
                        <i class="fas fa-file-export"></i> 导出Excel
                    </button>
                </div>

                <div class="card-body tab-content p-0">
                    <!-- 科研成果 -->
                    <div class="tab-pane fade show active" id="researchAchievement">
                        <div class="table-responsive">
                            <table id="researchAchievementTable" class="layui-table" lay-filter="researchAchievement"></table>
                        </div>
                    </div>

                    <!-- 科研论文 -->
                    <div class="tab-pane fade" id="researchPaper">
                        <div class="table-responsive">
                            <table id="researchPaperTable" class="layui-table" lay-filter="researchPaper"></table>
                        </div>
                    </div>

                    <!-- 专利 -->
                    <div class="tab-pane fade" id="researchPatent">
                        <div class="table-responsive">
                            <table id="patentTable" class="layui-table" lay-filter="patent"></table>
                        </div>
                    </div>

                    <!-- 著作权 -->
                    <div class="tab-pane fade" id="researchCopyright">
                        <div class="table-responsive">
                            <table id="copyrightTable" class="layui-table" lay-filter="copyright"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript 库 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/static/layui/layui.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

<script>
    // 初始化所有表格
    layui.use(['table'], function(){
        var table = layui.table;

        // 教学成果表
        table.render({
            elem: '#teachingAchievementTable',
            url: '/api/achievements?category=1&subcategory=1',
            cols: [[
                {field: 'award_year', title: '获得年份', width: 120, sort: true},
                {field: 'achievement_name', title: '成果名称'},
                {field: 'achievement_level', title: '层次', width: 120, templet: function(d){
                    const levels = ['', '校级', '省部级', '国家级'];
                    const colors = ['', 'success', 'warning', 'danger'];
                    return '<span class="badge bg-' + colors[d.achievement_level] + ' achievement-badge">'
                         + levels[d.achievement_level] + '</span>';
                }}
            ]],
            page: true
        });

        // 教学论文表
        table.render({
            elem: '#teachingPaperTable',
            url: '/api/achievements?category=1&subcategory=2',
            cols: [[
                {field: 'publish_year', title: '发表年份', width: 120, sort: true},
                {field: 'paper_name', title: '论文题目'},
                {field: 'publication_name', title: '期刊/会议', width: 150},
                {field: 'publication_info', title: '刊号/会议时间', width: 150}
            ]],
            page: true
        });

        // 其他表格初始化...
    });

    // 导航联动控制
    $(document).ready(function(){
        // 监听所有子导航切换
        $('[data-bs-toggle="tab"]').on('shown.bs.tab', function(e){
            const targetId = $(e.target).attr('href');

            // 如果是三级导航被点击
            if (targetId.includes('teaching') || targetId.includes('research')) {
                // 获取所属的二级导航ID
                const parentTabId = targetId.replace(/teaching|research.*/, '') +
                                  (targetId.includes('teaching') ? 'teachingTab' : 'researchTab');

                // 激活对应的二级导航
                $('.nav-pills a[href="#' + parentTabId + '"]').tab('show');
            }
        });
    });

    // 导出数据
    function exportData(type) {
        const tabContent = $('#' + type + 'Tab .tab-content .active');
        let subcategory = 1;

        if (tabContent.attr('id').includes('Paper')) subcategory = 2;
        else if (tabContent.attr('id').includes('Textbook')) subcategory = 3;
        else if (tabContent.attr('id').includes('Reform')) subcategory = 4;

        window.location.href = '/api/achievements/export?category=' +
            (type === 'teaching' ? 1 : 2) + '&subcategory=' + subcategory;
    }
</script>
</body>
</html>